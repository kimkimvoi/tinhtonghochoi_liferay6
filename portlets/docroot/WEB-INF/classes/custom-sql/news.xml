<?xml version="1.0" encoding="UTF-8"?>

<custom-sql>
	<sql id="getNews_Approved_Latest_GroupId_CategoryId">
		<![CDATA[
			SELECT JOURNALARTICLE.* , CAT.VIEWCOUNT
			FROM JOURNALARTICLE 
			JOIN 
				(SELECT RESOURCEPRIMKEY, "MAX"("VERSION") AS LATEST_VERSION
					FROM JOURNALARTICLE 
					WHERE GROUPID = ?
					AND STATUS = ?
					AND STRUCTUREID = ?
					GROUP BY RESOURCEPRIMKEY
				) APPROVED_LATEST 
				ON APPROVED_LATEST.RESOURCEPRIMKEY = JOURNALARTICLE.RESOURCEPRIMKEY
				AND APPROVED_LATEST.LATEST_VERSION = JOURNALARTICLE."VERSION"
			JOIN 
				(SELECT CLASSPK, VIEWCOUNT FROM ASSETENTRY 
					[$JOIN_ASSETENTRY_ASSETCATEGORY$]
				) CAT
			ON CAT.CLASSPK = JOURNALARTICLE.RESOURCEPRIMKEY 
			ORDER BY [$ORDER_BY$]
		]]>
	</sql>
	<sql id="countNews_Approved_Latest_GroupId_CategoryId">
		<![CDATA[
			SELECT COUNT (JOURNALARTICLE.ARTICLEID) AS COUNT_VALUE
			FROM JOURNALARTICLE 
			JOIN 
				(SELECT RESOURCEPRIMKEY, "MAX"("VERSION") AS LATEST_VERSION
					FROM JOURNALARTICLE 
					WHERE GROUPID = ?
					AND STATUS = ?
					AND STRUCTUREID = ?
					GROUP BY RESOURCEPRIMKEY
				) APPROVED_LATEST 
				ON APPROVED_LATEST.RESOURCEPRIMKEY = JOURNALARTICLE.RESOURCEPRIMKEY
				AND APPROVED_LATEST.LATEST_VERSION = JOURNALARTICLE."VERSION"
			JOIN 
				(SELECT CLASSPK, VIEWCOUNT FROM ASSETENTRY 
					[$JOIN_ASSETENTRY_ASSETCATEGORY$]
				) CAT
			ON CAT.CLASSPK = JOURNALARTICLE.RESOURCEPRIMKEY 
		]]>
	</sql>
	
	<sql id="getNews_Approved_Latest_GroupId_CategoriesId">
		<![CDATA[
			SELECT JOURNALARTICLE.* , CAT.VIEWCOUNT
			FROM JOURNALARTICLE 
			JOIN 
				(SELECT RESOURCEPRIMKEY, "MAX"("VERSION") AS LATEST_VERSION
					FROM JOURNALARTICLE 
					WHERE GROUPID = ?
					AND STATUS = ?
					AND STRUCTUREID = ?
					GROUP BY RESOURCEPRIMKEY
				) APPROVED_LATEST 
				ON APPROVED_LATEST.RESOURCEPRIMKEY = JOURNALARTICLE.RESOURCEPRIMKEY
				AND APPROVED_LATEST.LATEST_VERSION = JOURNALARTICLE."VERSION"
			JOIN 
				(SELECT CLASSPK, VIEWCOUNT FROM ASSETENTRY 
					[$JOIN_ASSETENTRY_ASSETCATEGORIES$]
					[$IN$] 
					[$CATEGORIES_ID$]
					[$END_CLOSE$]
				) CAT
			ON CAT.CLASSPK = JOURNALARTICLE.RESOURCEPRIMKEY 
			ORDER BY [$ORDER_BY$]
		]]>
	</sql>
</custom-sql>